<template lang="pug">
  .chart
    d3-barchart(:data='chartData' :options='options')
    ul.menu
      li 
        button.btn(@click='randomize') Randomize data
      li
        label Width {{width}}
        input(type='range' min='100' max='2000' v-model='width') 
      li
        label Height {{height}}
        input(type='range' min='50' max='700' v-model='height') 
    
    ul.menu
      li
        label Axis valuesY:
        input(type='checkbox' v-model='opts.axis.valuesY')    
      li
        label Axis linesY:
        input(type='checkbox' v-model='opts.axis.linesY')  
      li
        label Marks:
        input(type='checkbox' v-model='opts.marks')  

    .color(v-for='color,i in opts.colors' :key='i')
      input(type='color' v-model='opts.colors[i]' )
      input(type='number' :value='i' @change='switchColor' :id='i')  
    
    input(type='color' v-model='newColor' )
    input(type='number' v-model='newPos')  
    button.btn(@click='addColor') +
    select(v-model='opts.colorScale')
      option(v-for='cs in colorScales') {{cs}}

</template>
<script>
import d3Barchart from '../vue-d3-barchart.vue'
export default {
  name: 'bar-chart-example',
  components: {
    d3Barchart
  },
  data () {
    return {
      chartData: [],
      colorScales: [
        'scaleLinear',
        'scaleThreshold',
        'scaleQuantize',
        'scaleQuantile',
        'scaleOrdinal'
      ],
      newPos: 50,
      newColor: '#FF2200',
      width: 900,
      height: 300,
      opts: {
        axis: { valuesY: true, linesY: true },
        labels: true,
        padding: 0.3,
        margin: 40,
        bars: true,
        line: true,
        axisTicks: 20,
        marks: {
          type: 'point',
          size: 10
        },
        value: true,
        colors: { 0: '#ff0000', 300: '#00ff00' },
        colorScale: 'scaleLinear',
        curve: {
          type: 'Linear',
          gradient: {
            stroke: true
          },
        }
      }
    }
  },
  created () {
    this.randomize()
  },
  computed: {
    options () {
      let options = Object.assign({}, this.opts)
      options.size = { w: this.width, h: this.height }
      return options
    }
  },
  methods: {
    switchColor (event) {
      let oldKey = event.target.id
      let newKey = event.target.value
      let colors = Object.assign({}, this.opts.colors)
      console.log(oldKey, newKey)
      this.$set(colors, newKey, colors[oldKey])
      this.$delete(colors, oldKey)
      this.$set(this.opts, 'colors', colors)
    },
    addColor () {
      this.$set(this.opts.colors, this.newPos, this.newColor)
    },
    randomize () {
      this.chartData = this.randomData()
    },
    randomData () {
      return Array.apply(null, { length: 50 })
        .map((value, index) => { return Math.floor(Math.random() * 300) })
    }
  }
}
</script>
<style lang="stylus">
   svg 
    overflow visible
  .chart
    display: inline-block
    margin-top: 5em
    padding: 1em
  .menu-container 
    position relative 
  ul
    list-style none
  input 
    display inline
  label
    display inline-block
      
</style>
